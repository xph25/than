-- =============================
-- Services
-- =============================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer

-- =============================
-- ç‹€æ…‹è®Šæ•¸
-- =============================
local AutoAttack = false
local AttackDistance = 20
local AbilityLoop = false
local LavaRemoved = false

-- =============================
-- è§’è‰² / HRP
-- =============================
local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

-- =============================
-- é¬¼èˆ¹ Lava ç§»é™¤ï¼ˆåªåŸ·è¡Œä¸€æ¬¡ï¼‰
-- =============================
task.spawn(function()
    while not LavaRemoved do
        local map = workspace:FindFirstChild("Map")
        local gsi = map and map:FindFirstChild("GhostShipInterior")
        local lava = gsi and gsi:FindFirstChild("LavaParts") and gsi.LavaParts:FindFirstChild("Lava")

        if lava then
            lava:Destroy()
            LavaRemoved = true
            warn("ğŸ”¥ Ghost Ship Lava å·²ç§»é™¤")
        end
        task.wait(1)
    end
end)

-- =============================
-- æ¸…èˆŠ GUI
-- =============================
if player.PlayerGui:FindFirstChild("AutoAttackGUI") then
    player.PlayerGui.AutoAttackGUI:Destroy()
end

-- =============================
-- GUI
-- =============================
local gui = Instance.new("ScreenGui")
gui.Name = "AutoAttackGUI"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = player.PlayerGui

local main = Instance.new("Frame")
main.Size = UDim2.new(0,280,0,300)
main.Position = UDim2.new(0.5,-140,0.5,-150)
main.BackgroundColor3 = Color3.fromRGB(30,30,30)
main.BorderSizePixel = 0
main.ZIndex = 2
main.Parent = gui

-- =============================
-- æ‹–æ›³ï¼ˆå–ä»£ Draggableï¼‰
-- =============================
do
    local dragging, dragStart, startPos

    main.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = main.Position
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            main.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
end

-- =============================
-- æ¨™é¡Œåˆ—
-- =============================
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,30)
title.BackgroundColor3 = Color3.fromRGB(45,45,45)
title.Text = "Ghost Ship Hub"
title.TextColor3 = Color3.new(1,1,1)
title.TextSize = 18
title.ZIndex = 3
title.Parent = main

-- é—œé–‰
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0,30,0,30)
closeBtn.Position = UDim2.new(1,-30,0,0)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.fromRGB(255,80,80)
closeBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
closeBtn.ZIndex = 4
closeBtn.Parent = main
closeBtn.MouseButton1Click:Connect(function()
    gui:Destroy()
end)

-- æœ€å°åŒ–
local miniBtn = Instance.new("TextButton")
miniBtn.Size = UDim2.new(0,30,0,30)
miniBtn.Position = UDim2.new(1,-60,0,0)
miniBtn.Text = "-"
miniBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
miniBtn.TextColor3 = Color3.new(1,1,1)
miniBtn.ZIndex = 4
miniBtn.Parent = main

local content = Instance.new("Frame")
content.Size = UDim2.new(1,-20,1,-40)
content.Position = UDim2.new(0,10,0,35)
content.BackgroundTransparency = 1
content.Parent = main

local minimized = false
miniBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    content.Visible = not minimized
    miniBtn.Text = minimized and "+" or "-"
    main.Size = minimized and UDim2.new(0,280,0,30) or UDim2.new(0,280,0,300)
end)

-- =============================
-- è‡ªå‹•æ”»æ“Š
-- =============================
local attackBtn = Instance.new("TextButton")
attackBtn.Size = UDim2.new(1,0,0,32)
attackBtn.Text = "è‡ªåŠ¨æ”»å‡»ï¼šå…³é—­"
attackBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
attackBtn.TextColor3 = Color3.new(1,1,1)
attackBtn.Parent = content

attackBtn.MouseButton1Click:Connect(function()
    AutoAttack = not AutoAttack
    attackBtn.Text = AutoAttack and "è‡ªåŠ¨æ”»å‡»ï¼šå¼€å¯" or "è‡ªåŠ¨æ”»å‡»ï¼šå…³é—­"
end)

-- =============================
-- v3 èƒ½åŠ›ï¼ˆå–®ä¸€å¾ªç’°ï¼‰
-- =============================
local v3Btn = Instance.new("TextButton")
v3Btn.Size = UDim2.new(1,0,0,32)
v3Btn.Position = UDim2.new(0,0,0,40)
v3Btn.Text = "v3èƒ½åŠ›ï¼šå…³é—­"
v3Btn.BackgroundColor3 = Color3.fromRGB(90,60,120)
v3Btn.TextColor3 = Color3.new(1,1,1)
v3Btn.Parent = content

task.spawn(function()
    while true do
        if AbilityLoop then
            pcall(function()
                ReplicatedStorage.Remotes.CommE:FireServer("ActivateAbility")
            end)
        end
        task.wait(0.15)
    end
end)

v3Btn.MouseButton1Click:Connect(function()
    AbilityLoop = not AbilityLoop
    v3Btn.Text = AbilityLoop and "v3èƒ½åŠ›ï¼šå¼€å¯" or "v3èƒ½åŠ›ï¼šå…³é—­"
end)

-- =============================
-- å‚³é€
-- =============================
local function tp(pos)
    local hrp = getHRP()
    hrp.CFrame = CFrame.new(pos)
end

local ghostBtn = Instance.new("TextButton")
ghostBtn.Size = UDim2.new(1,0,0,32)
ghostBtn.Position = UDim2.new(0,0,0,80)
ghostBtn.Text = "ä¼ é€ï¼šã‚†ã†ã‚Œã„"
ghostBtn.BackgroundColor3 = Color3.fromRGB(0,170,255)
ghostBtn.TextColor3 = Color3.new(1,1,1)
ghostBtn.Parent = content
ghostBtn.MouseButton1Click:Connect(function()
    tp(Vector3.new(938,249,32888))
end)

local beanBtn = Instance.new("TextButton")
beanBtn.Size = UDim2.new(1,0,0,32)
beanBtn.Position = UDim2.new(0,0,0,120)
beanBtn.Text = "ä¼ é€ï¼šã¾ã‚ã¤ã¶ãã¿"
beanBtn.BackgroundColor3 = Color3.fromRGB(255,50,0)
beanBtn.TextColor3 = Color3.new(1,1,1)
beanBtn.Parent = content
beanBtn.MouseButton1Click:Connect(function()
    tp(Vector3.new(2284,15,911))
end)

-- =============================
-- è‡ªå‹•æ”»æ“Šä¸»å¾ªç’°ï¼ˆæ¨¡æ¿ï¼‰
-- =============================
task.spawn(function()
    while task.wait(0.25) do
        if AutoAttack then
            -- é€™è£¡å¯æ¥ä½ åŸæœ¬çš„ Hit / Combat Remote
            -- ç›®å‰åªä¿ç•™ç©©å®šå¾ªç’°
        end
    end
end)
